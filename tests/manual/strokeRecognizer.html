<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="assets/style.css">
    <title>Hammer.js</title>

    <style>
        path.sourcePath{
            transition: all 0.5s ease-out;
        }
    </style>
</head>
<body>
<div class="container">

    <div id="hit" class="bg1" style="padding: 30px;">
        <div id="target" class="bg5" style="display: block; text-align: center;">
            <canvas style="width: 100%; height: 100%;"></canvas>
        </div>
    </div>

    <pre id="debug" style="overflow:hidden; background: #eee; padding: 15px;"></pre>

    <pre id="log" style="overflow:hidden;"></pre>

</div>
<script src="../../hammer.js"></script>

<script>

    var canvasEl = document.querySelector("canvas");
    canvasEl.addEventListener("contextmenu",function(e){
        e.preventDefault();
        e.stopPropagation();
        return false;
    });

    var customStrokes = {
        elbow: {
            points: [{"X":0,"Y":1.99005105471807e-14},{"X":25.99676513671875,"Y":21.185476303100586},{"X":51.012481689453125,"Y":43.51864242553711},{"X":74.66958618164062,"Y":67.28240966796875},{"X":96.37580871582031,"Y":92.83341979980469},{"X":115.18568420410156,"Y":120.57280731201172},{"X":129.6211395263672,"Y":150.79747009277344},{"X":137.6896209716797,"Y":183.2757568359375},{"X":137.6896209716797,"Y":216.72427368164062},{"X":129.62115478515625,"Y":249.2025146484375},{"X":115.18569946289062,"Y":279.4271545410156},{"X":96.37579345703125,"Y":307.16656494140625},{"X":74.66958618164062,"Y":332.71759033203125},{"X":51.012542724609375,"Y":356.4813537597656},{"X":25.99676513671875,"Y":378.81451416015625},{"X":0,"Y":400}]
        },
        n_tr: {
            points: [{"X":-127.26700014845576,"Y":0},{"X":-121.4358668316103,"Y":-7.630063289925346},{"X":-115.27141165503195,"Y":-15.05258668797046},{"X":-108.66505500646514,"Y":-22.073483238856966},{"X":-101.77583683108685,"Y":-28.837298086248467},{"X":-94.88661865570853,"Y":-35.60111293363997},{"X":-87.99740048033024,"Y":-42.36492778103144},{"X":-81.10818230495198,"Y":-49.12874262842294},{"X":-74.45406764736609,"Y":-56.11750919146314},{"X":-68.1969389905729,"Y":-63.48611984533366},{"X":-61.42322478875727,"Y":-70.36045118886756},{"X":-54.53400661337895,"Y":-77.12426603625906},{"X":-47.64478843800069,"Y":-83.88808088365053},{"X":-40.75557026262237,"Y":-90.65189573104203},{"X":-33.86635208724408,"Y":-97.4157105784335},{"X":-26.977133911865792,"Y":-104.17952542582498},{"X":-20.087915736487503,"Y":-110.94334027321648},{"X":-13.198697561109213,"Y":-117.70715512060795},{"X":-6.309479385730924,"Y":-124.47096996799942},{"X":0.43268193058486304,"Y":-122.04582479589155},{"X":1.4890469469710297,"Y":-113.36276819735008},{"X":2.289170800173167,"Y":-103.71959080303046},{"X":1.480148357200619,"Y":-94.13291375988786},{"X":1.0988388554026756,"Y":-84.54284708632764},{"X":1.2319779439942522,"Y":-74.95879118269639},{"X":1.2454363968911366,"Y":-65.39756022000608},{"X":0.7354000919228838,"Y":-55.74486371882412},{"X":1.3664914918735462,"Y":-46.06527036646622},{"X":2.1661824458637966,"Y":-36.39504293465947},{"X":2.010574270874713,"Y":-26.671747416192574},{"X":1.8549660958855725,"Y":-16.948451897725676},{"X":1.699357920896432,"Y":-7.225156379258806},{"X":1.5437497459072915,"Y":2.4981391392080923},{"X":3.184378985658327,"Y":11.93024410524663},{"X":2.4146396532469794,"Y":21.58394438373756},{"X":2.5746058403895518,"Y":31.241153764851163},{"X":3.7208202807574935,"Y":40.64552068265988},{"X":3.6411735269406336,"Y":50.35759436724652},{"X":4.206012511481674,"Y":60.02049547256604},{"X":4.025237258528591,"Y":69.55450713997527},{"X":4.133148139982268,"Y":79.2557121018254},{"X":3.513893665749549,"Y":88.82221807010541},{"X":3.8305722232655057,"Y":98.16239907513767},{"X":4.311612774624109,"Y":107.68626098204004},{"X":5.441707688935935,"Y":116.76842392040817},{"X":5.70045410320995,"Y":125.52903003200055},{"X":10.632272806422009,"Y":121.79576092955756},{"X":17.52149098180024,"Y":115.03194608216603},{"X":24.41070915717853,"Y":108.26813123477456},{"X":31.299927332556877,"Y":101.50431638738308},{"X":38.189145507935166,"Y":94.74050153999156},{"X":45.0783636833134,"Y":87.97668669260014},{"X":51.96758185869169,"Y":81.21287184520861},{"X":58.856800034070034,"Y":74.44905699781714},{"X":65.74601820944827,"Y":67.68524215042567},{"X":71.46761352935368,"Y":60.162722954938374},{"X":78.35683170473192,"Y":53.398908107546845},{"X":85.24604988011026,"Y":46.63509326015537},{"X":89.62727708733422,"Y":38.52347051970821},{"X":96.51649526271245,"Y":31.75965567231674},{"X":102.06534532540934,"Y":24.406737279965398},{"X":108.95456350078769,"Y":17.642922432573926},{"X":115.84378167616597,"Y":10.879107585182396},{"X":122.7329998515442,"Y":4.1152927377909805}]
        }
    };

    var strokeOptions =  {
        shapeName: "elbow",
        firstStrokeDirection: [Hammer.DIRECTION_DOWN, Hammer.DIRECTION_RIGHT],
        recognizeThreshold: 0.9,
        inFlight: true,
        minDrawnLength: 200,
        customStrokes: customStrokes
    };

    var mc = new Hammer(canvasEl, {
        touchAction: "none",
        recognizers: [[Hammer.Stroke, strokeOptions]]
    });


    mc.on("strokestart", function(ev){
        var x = ev.center.x;
        var y = ev.center.y;

        x -= _rc.x;
        y -= _rc.y - document.body.scrollTop;
        if (_points.length > 0)
            _g.clearRect(0, 0, _rc.width, _rc.height);

        _points = []; // clear
        _points.push(new Point(x, y));

//        _g.fillRect(x - 4, y - 3, 9, 9);

        _g.beginPath();
        _g.arc(x, y, 15, 0, 2 * Math.PI, false);
        _g.fillStyle = 'rgba(255,255,255,1)';
        _g.fill();


    });

    mc.on("hammer.input", function(ev){
        var x = ev.center.x;
        var y = ev.center.y;

        x -= _rc.x;
        y -= _rc.y - document.body.scrollTop;

        _points.push(new Point(x, y)); // append
        if (_points.length>1) {
            drawConnectedPoint(_points.length - 2, _points.length - 1);
        }
    });


    mc.on("stroke", function(ev){
        console.log(ev.isRecognized, ev.result);
    });



//        mc.on("path pathstart pathend pathmove pathcancel",
//                logGesture);
//
//
//        function logGesture(ev) {
//            console.log(ev.timeStamp, ev.type, ev);
//        }


    var _g = canvasEl.getContext('2d');

    var rect= canvasEl.getBoundingClientRect();

    _g.canvas.width = rect.width;
    _g.canvas.height = rect.height;

    var _rc = getCanvasRect(canvasEl); // canvas rect on page

    var _points = new Array();


    function getCanvasRect(canvas)
    {
        var w = canvas.width;
        var h = canvas.height;

        var cx = canvas.offsetLeft;
        var cy = canvas.offsetTop;
        while (canvas.offsetParent != null)
        {
            canvas = canvas.offsetParent;
            cx += canvas.offsetLeft;
            cy += canvas.offsetTop;
        }

        return {x: cx, y: cy, width: w, height: h};
    }


    function drawConnectedPoint(from, to)
    {
        _g.strokeStyle = "white";
        _g.lineWidth = 8;

        _g.beginPath();
        _g.moveTo(_points[from].X, _points[from].Y);
        _g.lineTo(_points[to].X, _points[to].Y);
        _g.closePath();
        _g.stroke();
    }

    function Point(x, y) // constructor
    {
        this.X = x;
        this.Y = y;
    }



</script>
</body>
</html>