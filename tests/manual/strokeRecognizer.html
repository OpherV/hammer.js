<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="assets/style.css">
    <title>Hammer.js</title>

    <style>
        path.sourcePath{
            transition: all 0.5s ease-out;
        }
    </style>
</head>
<body>
<div class="container">

    <div id="hit" class="bg1" style="padding: 30px;">
        <div id="target" class="bg5" style="display: block; text-align: center;">
            <canvas style="width: 100%; height: 100%;"></canvas>
        </div>
    </div>

    <pre id="debug" style="overflow:hidden; background: #eee; padding: 15px;"></pre>

    <pre id="log" style="overflow:hidden;"></pre>

</div>
<script src="../../hammer.js"></script>

<script>

    var canvasEl = document.querySelector("canvas");
    canvasEl.addEventListener("contextmenu",function(e){
        e.preventDefault();
        e.stopPropagation();
        return false;
    });

    var customStrokes = {
        elbow: {
            points: [{"X":-161.32006110809078,"Y":1.1368683772161603e-13},{"X":-155.52500508026048,"Y":-3.789731779323688},{"X":-149.33269776326813,"Y":-6.410122641074395},{"X":-143.34624509557517,"Y":-9.737267506610351},{"X":-137.290121574404,"Y":-12.825213720036913},{"X":-131.09543884014448,"Y":-15.43744913973211},{"X":-124.8454368412709,"Y":-17.806004094226637},{"X":-118.54288527975103,"Y":-19.943079075857042},{"X":-112.24033371823128,"Y":-22.080154057487448},{"X":-105.93778215671148,"Y":-24.217229039117967},{"X":-99.63523059519162,"Y":-26.354304020748373},{"X":-93.40885601590145,"Y":-28.79698394739887},{"X":-87.32885057862859,"Y":-31.826864000512955},{"X":-81.24884514135579,"Y":-34.85674405362704},{"X":-75.03279269106338,"Y":-37.288093738894645},{"X":-68.6530393313846,"Y":-38.999251460096275},{"X":-62.273285971705775,"Y":-40.710409181297905},{"X":-56.02390258560888,"Y":-43.05631634197283},{"X":-49.82921985134948,"Y":-45.668551761668084},{"X":-43.63453711708996,"Y":-48.28078718136334},{"X":-37.43985438283045,"Y":-50.89302260105853},{"X":-31.24517164857093,"Y":-53.505258020753786},{"X":-25.050488914311472,"Y":-56.11749344044898},{"X":-18.855806180051957,"Y":-58.729728860144235},{"X":-12.661123445792441,"Y":-61.34196427983943},{"X":-6.466440711533039,"Y":-63.95419969953463},{"X":-0.27175797727352347,"Y":-66.56643511922988},{"X":5.90677187133133,"Y":-69.23412771051687},{"X":11.893224539024288,"Y":-72.56127257605289},{"X":17.96312552858302,"Y":-75.60191705994316},{"X":24.157808262842536,"Y":-78.21415247963836},{"X":30.352490997102052,"Y":-80.82638789933361},{"X":35.79319105877198,"Y":-83.52747165700487},{"X":39.078286835477456,"Y":-76.44687491137478},{"X":41.88633426441095,"Y":-68.84685590407696},{"X":43.90531341429306,"Y":-60.83192932439823},{"X":45.32295856672732,"Y":-52.61024967360504},{"X":46.98586678046627,"Y":-44.472897353996984},{"X":49.004845930348324,"Y":-36.45797077431831},{"X":51.02382508023038,"Y":-28.443044194639583},{"X":53.04280423011255,"Y":-20.42811761496091},{"X":55.282537417971184,"Y":-12.516916545539573},{"X":57.70910901373708,"Y":-4.693505078398914},{"X":59.90519553087478,"Y":3.225419364050083},{"X":61.44311727097943,"Y":11.417087172237927},{"X":63.012902736517844,"Y":19.59834655187217},{"X":64.66463358631626,"Y":27.752838104902253},{"X":66.31636443611455,"Y":35.907329657932394},{"X":67.82784588546309,"Y":44.10629625320155},{"X":69.28787110454476,"Y":52.321167141542105},{"X":71.30685025442682,"Y":60.336093721220834},{"X":73.32582940430893,"Y":68.3510203008995},{"X":74.83685231627862,"Y":76.5476487225788},{"X":76.28669971280323,"Y":84.76616033617904},{"X":77.73654710932794,"Y":92.98467194977928},{"X":78.81729584476057,"Y":101.28566908233512},{"X":79.5821905475076,"Y":109.65725271803126},{"X":80.89953530088633,"Y":117.91272342839079},{"X":82.6510553043928,"Y":126.01960888640588},{"X":84.51714232353265,"Y":134.07310839074063},{"X":84.97340855488517,"Y":142.48228945148924},{"X":85.99339016619297,"Y":150.80232084742272},{"X":87.16205052388557,"Y":158.88676909564902},{"X":88.67993889190916,"Y":166.47252834299513}]
        },
        n_tr: {
            points: [{"X":-127.26700014845576,"Y":0},{"X":-121.4358668316103,"Y":-7.630063289925346},{"X":-115.27141165503195,"Y":-15.05258668797046},{"X":-108.66505500646514,"Y":-22.073483238856966},{"X":-101.77583683108685,"Y":-28.837298086248467},{"X":-94.88661865570853,"Y":-35.60111293363997},{"X":-87.99740048033024,"Y":-42.36492778103144},{"X":-81.10818230495198,"Y":-49.12874262842294},{"X":-74.45406764736609,"Y":-56.11750919146314},{"X":-68.1969389905729,"Y":-63.48611984533366},{"X":-61.42322478875727,"Y":-70.36045118886756},{"X":-54.53400661337895,"Y":-77.12426603625906},{"X":-47.64478843800069,"Y":-83.88808088365053},{"X":-40.75557026262237,"Y":-90.65189573104203},{"X":-33.86635208724408,"Y":-97.4157105784335},{"X":-26.977133911865792,"Y":-104.17952542582498},{"X":-20.087915736487503,"Y":-110.94334027321648},{"X":-13.198697561109213,"Y":-117.70715512060795},{"X":-6.309479385730924,"Y":-124.47096996799942},{"X":0.43268193058486304,"Y":-122.04582479589155},{"X":1.4890469469710297,"Y":-113.36276819735008},{"X":2.289170800173167,"Y":-103.71959080303046},{"X":1.480148357200619,"Y":-94.13291375988786},{"X":1.0988388554026756,"Y":-84.54284708632764},{"X":1.2319779439942522,"Y":-74.95879118269639},{"X":1.2454363968911366,"Y":-65.39756022000608},{"X":0.7354000919228838,"Y":-55.74486371882412},{"X":1.3664914918735462,"Y":-46.06527036646622},{"X":2.1661824458637966,"Y":-36.39504293465947},{"X":2.010574270874713,"Y":-26.671747416192574},{"X":1.8549660958855725,"Y":-16.948451897725676},{"X":1.699357920896432,"Y":-7.225156379258806},{"X":1.5437497459072915,"Y":2.4981391392080923},{"X":3.184378985658327,"Y":11.93024410524663},{"X":2.4146396532469794,"Y":21.58394438373756},{"X":2.5746058403895518,"Y":31.241153764851163},{"X":3.7208202807574935,"Y":40.64552068265988},{"X":3.6411735269406336,"Y":50.35759436724652},{"X":4.206012511481674,"Y":60.02049547256604},{"X":4.025237258528591,"Y":69.55450713997527},{"X":4.133148139982268,"Y":79.2557121018254},{"X":3.513893665749549,"Y":88.82221807010541},{"X":3.8305722232655057,"Y":98.16239907513767},{"X":4.311612774624109,"Y":107.68626098204004},{"X":5.441707688935935,"Y":116.76842392040817},{"X":5.70045410320995,"Y":125.52903003200055},{"X":10.632272806422009,"Y":121.79576092955756},{"X":17.52149098180024,"Y":115.03194608216603},{"X":24.41070915717853,"Y":108.26813123477456},{"X":31.299927332556877,"Y":101.50431638738308},{"X":38.189145507935166,"Y":94.74050153999156},{"X":45.0783636833134,"Y":87.97668669260014},{"X":51.96758185869169,"Y":81.21287184520861},{"X":58.856800034070034,"Y":74.44905699781714},{"X":65.74601820944827,"Y":67.68524215042567},{"X":71.46761352935368,"Y":60.162722954938374},{"X":78.35683170473192,"Y":53.398908107546845},{"X":85.24604988011026,"Y":46.63509326015537},{"X":89.62727708733422,"Y":38.52347051970821},{"X":96.51649526271245,"Y":31.75965567231674},{"X":102.06534532540934,"Y":24.406737279965398},{"X":108.95456350078769,"Y":17.642922432573926},{"X":115.84378167616597,"Y":10.879107585182396},{"X":122.7329998515442,"Y":4.1152927377909805}]
        }
    };

    var strokeOptions =  {
        shapeName: "elbow",
        firstStrokeDirection: [Hammer.DIRECTION_DOWN, Hammer.DIRECTION_LEFT],
        recognizeThreshold: 0.9,
        inFlight: true,
        customStrokes: customStrokes
    };

    var mc = new Hammer(canvasEl, {
        touchAction: "none",
        recognizers: [[Hammer.Stroke, strokeOptions]]
    });


    mc.on("strokestart", function(ev){
        var x = ev.center.x;
        var y = ev.center.y;

        x -= _rc.x;
        y -= _rc.y - document.body.scrollTop;
        if (_points.length > 0)
            _g.clearRect(0, 0, _rc.width, _rc.height);

        _points = []; // clear
        _points.push(new Point(x, y));

//        _g.fillRect(x - 4, y - 3, 9, 9);

        _g.beginPath();
        _g.arc(x, y, 15, 0, 2 * Math.PI, false);
        _g.fillStyle = 'rgba(255,255,255,1)';
        _g.fill();


    });

//    mc.on("strokemove", function(ev){
    mc.on("hammer.input", function(ev){
        var x = ev.center.x;
        var y = ev.center.y;

        x -= _rc.x;
        y -= _rc.y - document.body.scrollTop;

        _points.push(new Point(x, y)); // append
        if (_points.length>1) {
            drawConnectedPoint(_points.length - 2, _points.length - 1);
        }
    });


    mc.on("stroke", function(ev){
        console.log(ev.isRecognized, ev.result);
    });



//        mc.on("path pathstart pathend pathmove pathcancel",
//                logGesture);
//
//
//        function logGesture(ev) {
//            console.log(ev.timeStamp, ev.type, ev);
//        }


    var _g = canvasEl.getContext('2d');

    var rect= canvasEl.getBoundingClientRect();

    _g.canvas.width = rect.width;
    _g.canvas.height = rect.height;

    var _rc = getCanvasRect(canvasEl); // canvas rect on page

    var _points = new Array();


    function getCanvasRect(canvas)
    {
        var w = canvas.width;
        var h = canvas.height;

        var cx = canvas.offsetLeft;
        var cy = canvas.offsetTop;
        while (canvas.offsetParent != null)
        {
            canvas = canvas.offsetParent;
            cx += canvas.offsetLeft;
            cy += canvas.offsetTop;
        }

        return {x: cx, y: cy, width: w, height: h};
    }


    function drawConnectedPoint(from, to)
    {
        _g.strokeStyle = "white";
        _g.lineWidth = 8;

        _g.beginPath();
        _g.moveTo(_points[from].X, _points[from].Y);
        _g.lineTo(_points[to].X, _points[to].Y);
        _g.closePath();
        _g.stroke();
    }

    function Point(x, y) // constructor
    {
        this.X = x;
        this.Y = y;
    }



</script>
</body>
</html>